############################################
# Script for Siril
# January 2020
# (C) Cyril Richard
#  Modified by Colmic
# DSLR_preprocessing v1.6
########### PREPROCESSING SCRIPT ###########
#                 No Darks
#
# Script for DSLR color camera preprocessing
# needs 3 sets of RAW images in the working
# directory, within 3 directories:
# bias, flats and lights 
#
# v 1.6: change biases to bias
############################################

#build master-bias
cd bias
convertraw bias_
stack bias_ rej 3 3 -nonorm
cd ..

cd flats
#preprocess flats
convertraw flat_
preprocess flat_ -bias=../bias/bias_stacked

#build master-flat
stack pp_flat_ rej 3 3 -norm=mul
cd ..

#preprocess lights
cd lights
convertraw light_
preprocess light_ -bias=../biases/bias_stacked -flat=../flats/pp_flat_stacked -equalize_cfa -debayer -stretch

#align lights
register pp_light_

#stack calibrated lights
stack r_pp_light_ rej 3 3 -norm=addscale -out=../result

cd ..
close